# Migrating from docknv 2.x to 3.x

docknv code structure changed in a more imperative form instead of its original OOP design, and project structure also changed a little, with a complete separation between autogenerated files and original project files.

## Custom commands

#### Old way (2.x)
```python
from docknv.v2.lifecycle_handler import LifecycleHandler
LifecycleHandler.exec_machine(...)
```

#### New way (3.x)

```python
from docknv.lifecycle_handler import lifecycle_machine_exec
lifecycle_machine_exec(...)
```

## Project structure

#### Old way (2.x)

- commands
- composefiles
- data
    - global
    - local *(autogenerated)*
- envs
- images
- templates

#### New way (3.x)

- commands
- composefiles
- data
    - **files** *(renamed from global)*
    - **templates** *(moved from project root)*
- envs
- images

So where is the autogenerated `data/local` folder ?  
In your **home** directory, under the `.docknv` config folder.

## Per-user docknv configuration

Now, user-specific files (like autogenerated templates) are stored in a custom user folder.

Here is the user folder structure:

- ~
    - **.docknv**
        - project1 *(your project name)*
            - config1 *(your config name)*
                - data *(<- here is the new data/local folder)*
                    - static
                    - templates
                - docker-compose.yml *(<- here is your docker-compose file)*
            - ...
        - project2
            - ...

## Lockfile system

Now, you can only execute **one docknv command at once**, by using a lockfile.

## New commands

### `docknv bundle`

The `bundle` command can be used to control the lifecycle of multiple configurations at once.  
For example, to stop the `base` and the `client` configuration at once and without changing the active configuration, just type:

```bash
docknv bundle stop base client
```

The active configuration will be automatically switched and the last used configuration will be reset when the command will terminate.

